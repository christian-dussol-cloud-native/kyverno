---
# Complete test scenario combining all ingress types
# Use this to validate all policies at once

# Namespace for testing
apiVersion: v1
kind: Namespace
metadata:
  name: test-migration
  labels:
    test: migration-scenarios

---
# Scenario 1: Ingress NGINX (should be detected and blocked)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: scenario-nginx
  namespace: test-migration
  labels:
    scenario: nginx-ingress
spec:
  ingressClassName: nginx
  rules:
  - host: scenario-nginx.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-nginx
            port:
              number: 80

---
# Scenario 2: Alternative controller (should pass with different category)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: scenario-traefik
  namespace: test-migration
  labels:
    scenario: other-controller
spec:
  ingressClassName: traefik
  rules:
  - host: scenario-traefik.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-traefik
            port:
              number: 80

---
# Scenario 3: Gateway API (recommended - should pass all policies)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: scenario-gateway-api
  namespace: test-migration
  labels:
    scenario: gateway-api
spec:
  parentRefs:
  - name: test-gateway
  hostnames:
  - "scenario-gateway.example.com"
  rules:
  - backendRefs:
    - name: app-gateway
      port: 80

---
# Services for test scenarios
apiVersion: v1
kind: Service
metadata:
  name: app-nginx
  namespace: test-migration
spec:
  selector:
    app: test
  ports:
  - port: 80
    targetPort: 8080

---
apiVersion: v1
kind: Service
metadata:
  name: app-traefik
  namespace: test-migration
spec:
  selector:
    app: test
  ports:
  - port: 80
    targetPort: 8080

---
apiVersion: v1
kind: Service
metadata:
  name: app-gateway
  namespace: test-migration
spec:
  selector:
    app: test
  ports:
  - port: 80
    targetPort: 8080